---
title: "p8105_hw3_jg5038"
author: "Julia Gray"
date: "2025-10-02"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


Problem 1

```{r}
data("instacart")

instacart_df = instacart |> 
  janitor::clean_names()

#order_dow is given as an integer but to make it human readable let's change it to a string. We don't know which day is which but in order to find out we can see the distribution by day and assume that the most orders happen on Saturday and Sunday

instacart_df |> 
  group_by(order_dow) |> 
  summarize(n = n_distinct(order_id))

#Let's assume that people order the most groceries on Monday so dow 0 = Monday

instacart_df = instacart_df |> 
  mutate(order_dow_string = 
         case_match(
           order_dow, 
           0 ~ "Mon", 
           1 ~ "Tues",
           2 ~ "Weds",
           3 ~ "Thurs", 
           4 ~ "Fri",
           5 ~ "Sat",
           6 ~ "Sun"
         ))

```

This dataset contains order information from instacart. It is organized by order and contains information about the products ordered, as well as information about the customer (i.e. how long it's been since they last ordered). It contains `r dim(instacart)[1]` observations and includes columns for `r colnames(instacart)`. For example, the first order in the dataset was made by `r unique(select(filter(instacart, order_id==1), user_id))` at `r unique(select(filter(instacart, order_id==1), order_hour_of_day))` o clock and we can see they ordered `r toString(select(filter(instacart, order_id==1), product_name))` (of which `r toString(select(filter(instacart, order_id==1, reordered==1), product_name))` were reordered).

There are `r dim(unique(select(instacart, aisle)))[1]` unique aisles. Here is a table of the aisles most ordered from (just showing the top 10):

```{r}
instacart_aisle_sum_df = instacart_df |> 
  group_by(aisle) |> 
  summarize(
    n = n()
  ) |> 
  arrange(desc(n)) 

instacart_aisle_sum_df |> 
  head(10) |> 
  knitr::kable()
```

Now let's plot aisles with more than 10,000 items ordered from them:

```{r}
#UPDATE labels and size to render correctly
instacart_aisle_sum_df |> 
  filter(n >= 10000) |> 
  ggplot(aes(x=reorder(aisle, n), y=n)) +
  geom_bar(stat="identity") +
  coord_flip()
```

In order to find the most popular items for each aisle let's group by:

```{r}
instacart_aisle_item_df = instacart_df |> 
  group_by(aisle) |> 
  count(product_name) |> 
  mutate(
    item_aisle_rank = min_rank(desc(n))
    ) |> 
  filter(aisle %in% c('baking ingredients', 'dog food care', 'packaged vegetables fruits'), item_aisle_rank <= 3) |> 
  arrange(aisle, item_aisle_rank)

knitr::kable(instacart_aisle_item_df)
```

To make a table showing the mean hour per day at which items are ordered for each day of the week we will group by day and calculate the mean:

```{r}
instacart_df |> 
  filter(product_name %in% c('Pink Lady Apples', 'Coffee Ice Cream')) |> 
  group_by (product_name, order_dow_string) |> 
  summarize(
    mean_order_hour_of_day = round(mean(order_hour_of_day, na.rm = TRUE), digits=2)
  ) |> 
  pivot_wider(
    names_from = order_dow_string,
    values_from = mean_order_hour_of_day
  ) |> 
  select('product_name', 'Mon', 'Tues', 'Weds', 'Thurs', 'Fri', 'Sat', 'Sun') |> 
  knitr::kable()
```









